<!--Copyright (C) 2016 R&D Solutions Ltd.-->

<!--Licensed under the Apache License, Version 2.0 (the "License");-->
<!--you may not use this file except in compliance with the License.-->
<!--You may obtain a copy of the License at-->

<!--http://www.apache.org/licenses/LICENSE-2.0-->

<!--Unless required by applicable law or agreed to in writing, software-->
<!--distributed under the License is distributed on an "AS IS" BASIS,-->
<!--WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.-->
<!--See the License for the specific language governing permissions and-->
<!--limitations under the License.-->

<div class="stage" ng-class="{'stage-selected': pipesRunManagement.selectedStage.id == stage.id}">
    <div class="panel panel-info p-box-inner">
        <!--<a class="p-link">-->
        <div class="p-link">
            <div class="panel-heading p-head-box">
                    <div class="display-inline-block width-100">
                        {{stage.stageDefinitionName}}
                        <!--<span ui-sref="index.pipelineConfig.stage.settings({groupName:pipesRunManagement.groupName,pipelineName:pipesRunManagement.pipelineName,stageName:stage[0].stageDefinitionName})" class="icon-settings font-lg ico"></span>-->
                        <div class="pull-right display-inline-block">
                            <i ng-class="{'fa fa-check icon-passed vertical-center-icon': stage.status == 'PASSED', 'fa fa-times text-danger vertical-center-icon' : stage.status == 'FAILED', 'fa fa-refresh fa-spin text-warning vertical-center-icon' : stage.status == 'IN_PROGRESS', 'fa fa-ban vertical-center-icon' : stage.status == 'CANCELED', 'fa fa-pause text-warning vertical-center-icon': stage.status == 'PAUSED'}"></i>
                        </div>
                </div>
            </div>
        </div>
        <!--</a>-->
        <div class="panel-body">
            <div>
                <p>
                    <!--<strong>{{pipesRunManagement.stageDefaultText.run}}</strong>-->
                    <!--<span ng-if="stage.LastRun.ExecutionID==0">Not Executed yet</span>-->
                    <!--<span ng-if="stage.LastRun.ExecutionID!=0">-->
 <!--<label>-->
   <!--<input type="number" name="input"-->
          <!--min="1" max="{{stage.length}}" class="spinner-custom" ng-value="stage.length"-->
          <!--ng-change="pipesRunManagement.selectStage(null,$index);pipesRunManagement.selectRun(pipesRunManagement.lastRunSelected)"-->
          <!--ng-model="pipesRunManagement.lastRunSelected" required>-->
 <!--</label>-->
          <!--of {{stage.length}}</span>-->
                <!--</p>-->
                <!--<p>-->
                    <!--<strong>{{pipesRunManagement.stageDefaultText.state}}</strong>-->
                    <!--<span class="btn btn-success btn-xs" ng-if="stage[stage.length-1].status=='PASSED'">Passed</span>-->
                    <!--<span class="btn btn-danger btn-xs" ng-if="stage[stage.length-1].status=='FAILED'">Failed</span>-->
                    <!--<span class="btn yellow btn-xs" ng-if="stage[stage.length-1].status=='IN_PROGRESS'">Running</span>-->
                    <!--<span class="btn yellow-mint btn-xs" ng-if="stage[stage.length-1].status=='SCHEDULED'">Scheduled</span>-->
                    <!--<span class="btn yellow-mint btn-xs" ng-if="stage[stage.length-1].status=='SCHEDULED' && stage.Runs.LastRunSelected==undefined ">{{stage.LastRun.status}}</span>-->
                    <!--<span class="btn btn-default btn-xs" ng-if="stage[stage.length-1].status=='NOT_RUN'">Not run</span>-->
                <!--</p>-->

                <!--<p>-->
                    <!--<strong>{{pipesRunManagement.stageDefaultText.start}}</strong>-->
                    <!--<span ng-if="stage.LastRun.ExecutionID!=0">{{stage.Runs[stage.LastRunSelected-1].Start | date:'dd.MM.yyyy HH:mm'}}</span>-->

                    <!--<span ng-if="stage.LastRun.ExecutionID==0">Not Executed yet</span>-->
                <!--</p>-->

                <!--<p>-->
                    <!--<strong>{{pipesRunManagement.stageDefaultText.duration}}</strong>-->
                    <!--<span ng-if="stage[pipesRunManagement.lastRunSelected - 1].executionId!=0">{{stage[stage.LastRunSelected-1].duration}}</span>-->
                    <!--<span ng-if="stage[pipesRunManagement.lastRunSelected - 1].executionId==0">Not Executed yet</span>-->

                <!--</p>-->

                <!--<p><strong>{{pipesRunManagement.stageDefaultText.trigger}}</strong> TEMP </p>-->
                <div class="job-list">
                <div class="height-50px" ng-repeat="job in stage.jobs" ng-class-even="'custom-nth-color'">
                    <div class="run-item-container display-inline-block width-100 pull-left pointer" ng-class="{'status-passed': job.status == 'PASSED', 'status-failed' : job.status == 'FAILED', 'status-working' : job.status == 'RUNNING', 'status-awaiting' : job.status == 'AWAITING' || (job.status != 'PASSED' && job.status != 'FAILED' && job.status != 'RUNNING' && job.status != 'CANCELED'), 'status-canceled' : job.status == 'CANCELED', 'jobSelected' : pipesRunManagement.selectedJob.id == job.id}" ng-click="pipesRunManagement.selectJob($parent.$index,$index)">
                        <div class="vertical-center display-inline-block width-100 pull-left padding-left-5">
                        {{job.jobDefinitionName.substr(0, 18)}}<span ng-if="job.jobDefinitionName.length > 18">...</span>
                        </div>
                        <span class="pull-right position-relative padding-right-5" aria-hidden="true">
                            <i class="fa fa-list"></i>
                        </span>
                    </div>
                </div>
            </div>
                <div class="controls left-buttons-stage" style="height:42px;">
                    <!--<button class="btn btn-primary" ng-click="pipesRunManagement.selectAlllJobs(stage);pipesRunManagement.reRunStageJobs(stage)">-->
                        <!--Run-->
                        <!--<span class="glyphicon glyphicon-play control"></span>-->
                    <!--</button>-->

                    <!--<button class="btn btn-primary" ng-if="stage.isTriggeredManually && stage.status == 'PAUSED'" ng-click="pipesRunManagement.continueStage(stage)">-->
                    <!--Continue-->
                    <!--<span class="glyphicon glyphicon-play control"></span>-->
                    <!--</button>-->

                    <div class="controls">
                        <button class="btn btn-default" ng-class="{'disabled' : pipesRunManagement.currentPipelineRun.permissionType == 'VIEWER' || pipesRunManagement.currentPipelineRun.permissionType == '' || (pipesRunManagement.currentPipelineRun.status != 'PAUSED' && pipesRunManagement.currentPipelineRun.rerunStatus != 'PAUSED') || stage.status != 'PAUSED'}" id="startbtn" ng-click="pipesRunManagement.pause(pipesRunManagement.currentPipelineRun)">
                            <span class="glyphicon glyphicon-play control"></span>
                        </button>

                        <button class="btn btn-default" data-target="#rerunStage" data-toggle="modal" ng-class="{'disabled' : pipesRunManagement.currentPipelineRun.permissionType == 'VIEWER' || pipesRunManagement.currentPipelineRun.permissionType == '' || (pipesRunManagement.currentPipelineRun.status == 'IN_PROGRESS' || pipesRunManagement.currentPipelineRun.status == 'PAUSED' || pipesRunManagement.currentPipelineRun.status == 'AWAITING') || ((pipesRunManagement.currentPipelineRun.rerunStatus == 'IN_PROGRESS' || pipesRunManagement.currentPipelineRun.rerunStatus == 'PAUSED' || pipesRunManagement.currentPipelineRun.rerunStatus == 'AWAITING') || (stage.status == 'IN_PROGRESS'))}"
                                ng-click="pipesRunManagement.setSelectedStageForReRun(stage);pipesRunManagement.selectAllJobs()">
                            <span class="glyphicon glyphicon-play control"></span><i class="fa fa-plus"></i>
                        </button>

                        <button class="btn btn-default" ng-class="{'disabled' : pipesRunManagement.currentPipelineRun.permissionType == 'VIEWER' || pipesRunManagement.currentPipelineRun.permissionType == '' || stage.status != 'IN_PROGRESS'}" ng-click="pipesRunManagement.pause(pipesRunManagement.currentPipelineRun)">
                            <span class="glyphicon glyphicon-pause control"></span>
                        </button>

                        <button class="btn btn-default" ng-class="{'disabled' : pipesRunManagement.currentPipelineRun.permissionType == 'VIEWER' || pipesRunManagement.currentPipelineRun.permissionType == '' || stage.status == 'PASSED' || stage.status == 'FAILED' || stage.status == 'NOT_RUN' || stage.status == 'SKIPPED' || stage.status == 'CANCELED'}" id="stopbtn" ng-click="pipesRunManagement.stop(pipesRunManagement.currentPipelineRun)">
                            <span class="glyphicon glyphicon-stop control"></span>
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
